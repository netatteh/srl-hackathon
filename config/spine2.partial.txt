system {
    configuration {
        auto-checkpoint true
        auto-save true
    }
}
network-instance default {
    protocols {
        bgp {
            autonomous-system 65100
            router-id 10.0.0.12
            afi-safi ipv4-unicast {
                admin-state enable
            }
            group ebgp-underlay {
                export-policy [
                    export-underlay
                ]
                import-policy [
                    import-underlay
                ]
            }
            group ibgp-overlay {
                next-hop-self true
                export-policy [
                    export-overlay
                ]
                import-policy [
                    import-overlay
                ]
                local-as {
                    as-number 65000
                }
                peer-as 65000
                route-reflector {
                    client true
                    cluster-id 10.0.0.0 
                }
                transport {
                    local-address 10.0.0.12
                }
            }
            neighbor 10.0.0.1 {
                peer-group ibgp-overlay
            }
            neighbor 10.0.0.2 {
                peer-group ibgp-overlay
            }
            neighbor 10.0.10.5 {
                peer-as 65001
                peer-group ebgp-underlay
            }
            neighbor 10.0.10.7 {
                peer-as 65002
                peer-group ebgp-underlay
            }
        }
    }
    interface system0.0 {
    }
    interface ethernet-1/1.0 {
    }
    interface ethernet-1/2.0 {
    }
}
interface system0 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.0.12/32 {
            }
        }
    }
}
interface ethernet-1/1 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.10.4/31 {
            }
        }
    }
}
interface ethernet-1/2 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.10.6/31 {
            }
        }
    }
}
routing-policy {
    prefix-set loopbacks {
        prefix 10.0.0.0/24 mask-length-range 32..32 {
        }
    }
    policy export-overlay {
        statement accept-bgp {
            match {
                protocol bgp
            }
            action {
                policy-result accept
            }
        }
    }
    policy export-underlay {
        statement accept-loopbacks {
            match {
                prefix {
                    prefix-set loopbacks
                }
            }
            action {
                policy-result accept
            }
        }
    }
    policy import-overlay {
        statement accept-bgp {
            match {
                protocol bgp
            }
            action {
                policy-result accept
            }
        }
    }
    policy import-underlay {
        statement accept-loopbacks {
            match {
                prefix {
                    prefix-set loopbacks
                }
            }
            action {
                policy-result accept
            }
        }
    }
}

