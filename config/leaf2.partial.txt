system {
    configuration {
        auto-checkpoint true
        auto-save true
    }
}
network-instance default {
    protocols {
        bgp {
            autonomous-system 65002
            router-id 10.0.0.2
            afi-safi evpn {
                admin-state enable
            }
            afi-safi ipv4-unicast {
                admin-state enable
            }
            group ebgp-underlay {
                afi-safi evpn {
                    admin-state disable
                }
                afi-safi ipv4-unicast {
                    admin-state enable
                }
                export-policy [
                    export-underlay 
                ]
                import-policy [
                    import-underlay
                ]
            }
            group ibgp-overlay {
                afi-safi evpn {
                    admin-state enable
                }
                afi-safi ipv4-unicast {
                    admin-state disable
                }
                peer-as 65000
                export-policy [
                    accept-evpn
                ]
                import-policy [
                    accept-evpn
                ]
                local-as {
                    as-number 65000
                }
                transport {
                    local-address 10.0.0.2
                }
            }
            neighbor 10.0.0.11 {
                peer-group ibgp-overlay
            }
            neighbor 10.0.0.12 {
                peer-group ibgp-overlay
            }
            neighbor 10.0.10.2 {
                peer-as 65100
                peer-group ebgp-underlay
            }
            neighbor 10.0.10.6 {
                peer-as 65100
                peer-group ebgp-underlay
            }
        }
    }
    interface system0.0 {
    }
    interface ethernet-1/31.0 {
    }
    interface ethernet-1/32.0 {
    }
}
network-instance l2 {
    type mac-vrf
    admin-state enable
    interface ethernet-1/1.0 {
    }
    interface ethernet-1/2.0 {
    }
    vxlan-interface vxlan1.100 {
    }
    protocols {
        bgp-evpn {
            bgp-instance 1 {
                admin-state enable
                vxlan-interface vxlan1.100
                evi 100
            }
        }
        bgp-vpn {
            bgp-instance 1 {
                route-target {
                    export-rt target:65000:100
                    import-rt target:65000:100
                }
            }
        }
    }
}
interface system0 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.0.2/32 {
            }
        }
    }
}
interface ethernet-1/1 {
    admin-state enable
    vlan-tagging true
    subinterface 0 {
        type bridged
        admin-state enable
        vlan {
            encap {
                single-tagged {
                    vlan-id 100
                }
            }
        }
    }
}
interface ethernet-1/2 {
    admin-state enable
    vlan-tagging true
    subinterface 0 {
        type bridged
        admin-state enable
        vlan {
            encap {
                single-tagged {
                    vlan-id 100
                }
            }
        }
    }
}
interface ethernet-1/31 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.10.3/31 {
            }
        }
    }
}
interface ethernet-1/32 {
    admin-state enable
    subinterface 0 {
        admin-state enable
        ipv4 {
            admin-state enable
            address 10.0.10.7/31 {
            }
        }
    }
}
routing-policy {
    prefix-set loopbacks {
        prefix 10.0.0.0/24 mask-length-range 32..32 {
        }
    }
    policy accept-evpn {
        statement accept-evpn {
            match {
                family [ evpn ]
            }
            action {
                policy-result accept
            }
        }
    }
    policy export-underlay {
        statement accept-loopbacks {
            match {
                prefix {
                    prefix-set loopbacks
                }
            }
            action {
                policy-result accept
            }
        }
    }
    policy import-underlay {
        statement accept-loopbacks {
            match {
                prefix {
                    prefix-set loopbacks
                }
            }
            action {
                policy-result accept
            }
        }
    }
}
tunnel-interface vxlan1 {
    vxlan-interface 100 {
        type bridged
        ingress {
            vni 100
        }
        egress {
            source-ip use-system-ipv4-address
        }
    }
}

